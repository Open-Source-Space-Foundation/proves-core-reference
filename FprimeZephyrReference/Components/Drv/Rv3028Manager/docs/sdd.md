# Components::Rv3028Manager

The RV3028 Manager component interfaces with the RV3028 Real Time Clock (RTC) to provide time measurements.

### Typical Usage

#### `timeGetPort` Port Usage
1. The component is instantiated and initialized during system startup
2. In a deployment topology, a `time connection` is made to the component's `timeGetPort` port

#### `timeRead` Port Usage
1. The component is instantiated and initialized during system startup
2. A manager calls the `timeRead` ports
3. On each call, the component:
    - Fetches and returns the time from the RV3028 RTC
    - Emits a `DeviceNotReady` event if the device is not ready

#### `timeSet` Port Usage
1. The component is instantiated and initialized during system startup
2. A manager calls the `timeSet` ports
3. On each call, the component:
    - Sets the time on the RV3028 RTC
    - Emits a `TimeSet` event if the time is set successfully
    - Emits a `TimeNotSet` event if the time is not set successfully
    - Emits a `DeviceNotReady` event if the device is not ready

## Requirements
| Name | Description | Validation |
|---|---|---|
| Rv3028Manager-001 | Time can be set on the RV3028 through a port | Manual |
| Rv3028Manager-002 | Time can be read from the RV3028 through a port | Manual |
| Rv3028Manager-003 | A device not ready event is emitted if the RV3028 is not ready | Manual |
| Rv3028Manager-004 | A time set event is emitted if the time is set successfully | Manual |
| Rv3028Manager-005 | A time not set event is emitted if the time is not set successfully | Manual |

## Port Descriptions
| Name | Description |
|---|---|
| timeGetPort | Time port for FPrime topology connection to get the time from the RV3028 |
| timeSet | Input port sets the time on the RV3028 |
| timeRead | Input port reads the time from the RV3028 |

## Events
| Name | Description |
|---|---|
| DeviceNotReady | Emits on unsuccessful device connection |
| TimeSet | Emits on successful time set |
| TimeNotSet | Emits on unsuccessful time set |

## Class Diagram
```mermaid
classDiagram
    namespace Drv {
        class Rv3028ManagerComponentBase {
            <<Auto-generated>>
        }
        class Rv3028Manager {
            - rv3028: device*
            + Rv3028Manager(char* compName)
            + ~Rv3028Manager()
            - void timeGetPort_handler(FwIndexType portNum, Fw::Time& time)
            - U32 timeRead_handler(FwIndexType portNum)
            - void timeSet_handler(FwIndexType portNum, const Drv::TimeData& time)
        }
    }
    Rv3028ManagerComponentBase <|-- Rv3028Manager : inherits
```

## Sequence Diagrams

### `timeGetPort` port

The `timeGetPort` port is called from a `time connection` in a deployment topology to sync the RTC's time with FPrime's internal clock.

#### Success
```mermaid
sequenceDiagram
    participant Deployment Time Connection
    participant RV3028 Manager
    participant Zephyr Time API
    participant RV3028 RTC
    Deployment Time Connection-->>RV3028 Manager: Call timeGetPort time port
    RV3028 Manager->>Zephyr Time API: Read time
    Zephyr Time API->>RV3028 RTC: Read time
    RV3028 RTC->>Zephyr Time API: Return time
    Zephyr Time API->>RV3028 Manager: Return time
    RV3028 Manager-->>Deployment Time Connection: Return time
```

#### Device Not Ready
```mermaid
sequenceDiagram
    participant Event Log
    participant Deployment Time Connection
    participant RV3028 Manager
    participant Zephyr Time API
    participant RV3028 RTC
    Deployment Time Connection->>RV3028 Manager: Call timeGetPort time port
    RV3028 Manager->>Zephyr Time API: Read time
    Zephyr Time API->>RV3028 RTC: Read time
    RV3028 RTC->>Zephyr Time API: Return device not ready
    Zephyr Time API->>RV3028 Manager: Return device not ready
    RV3028 Manager->>Event Log: Emit DeviceNotReady event
    RV3028 Manager->>Deployment Time Connection: Return 0 time
```

### `timeRead` port

The `timeRead` port is called from a manager component to get the current time from the RTC.

#### Success
```mermaid
sequenceDiagram
    participant Event Log
    participant Manager
    participant RV3028 Manager
    participant Zephyr Time API
    participant RV3028 RTC
    Manager-->>RV3028 Manager: Call timeRead synchronous input port
    RV3028 Manager->>Zephyr Time API: Read time
    Zephyr Time API->>RV3028 RTC: Read time
    RV3028 RTC->>Zephyr Time API: Return time
    Zephyr Time API->>RV3028 Manager: Return time
    RV3028 Manager->>Event Log: Emit event GetTime
```

#### Device Not Ready
```mermaid
sequenceDiagram
    participant Event Log
    participant Manager
    participant RV3028 Manager
    participant Zephyr Time API
    participant RV3028 RTC
    Manager-->>RV3028 Manager: Call timeRead synchronous input port
    RV3028 Manager->>Zephyr Time API: Read time
    Zephyr Time API->>RV3028 RTC: Read time
    RV3028 RTC->>Zephyr Time API: Return device not ready
    Zephyr Time API->>RV3028 Manager: Return device not ready
    RV3028 Manager->>Event Log: Emit event DeviceNotReady
```

### `timeSet` port

The `timeSet` port is called from a manager component to set the current time on the RTC.

#### Success
```mermaid
sequenceDiagram
    participant Ground Station
    participant Event Log
    participant Manager
    participant RV3028 Manager
    participant Zephyr Time API
    participant RV3028 RTC
    Ground Station-->>Manager: Command to set time with Drv::TimeData struct
    Manager->>RV3028 Manager: Call the timeSet synchronous input port with Drv::TimeData struct
    RV3028 Manager->>Zephyr Time API: Set time
    Zephyr Time API->>RV3028 RTC: Set time
    RV3028 RTC->>Zephyr Time API: Return set success
    Zephyr Time API->>RV3028 Manager: Return set success
    RV3028 Manager->>Event Log: Emit event TimeSet
```

#### Device Not Ready
```mermaid
sequenceDiagram
    participant Ground Station
    participant Event Log
    participant Manager
    participant RV3028 Manager
    participant Zephyr Time API
    participant RV3028 RTC
    Ground Station-->>Manager: Command to set time with Drv::TimeData struct
    Manager->>RV3028 Manager: Call the timeSet synchronous input port with Drv::TimeData struct
    RV3028 Manager->>Zephyr Time API: Set time
    Zephyr Time API->>RV3028 RTC: Set time
    RV3028 RTC->>Zephyr Time API: Return device not ready
    Zephyr Time API->>RV3028 Manager: Return device not ready
    RV3028 Manager->>Event Log: Emit event DeviceNotReady
```

#### Time Not Set
```mermaid
sequenceDiagram
    participant Ground Station
    participant Event Log
    participant Manager
    participant RV3028 Manager
    participant Zephyr Time API
    participant RV3028 RTC
    Ground Station-->>Manager: Command to set time with Drv::TimeData struct
    Manager->>RV3028 Manager: Call the timeSet synchronous input port with Drv::TimeData struct
    RV3028 Manager->>Zephyr Time API: Set time
    Zephyr Time API->>RV3028 RTC: Set time
    RV3028 RTC->>Zephyr Time API: Return set failure
    Zephyr Time API->>RV3028 Manager: Return set failure
    RV3028 Manager->>Event Log: Emit event TimeNotSet
```

## Change Log
| Date | Description |
|---|---|
| 2025-9-18 | Initial RV3028 Manager component |
